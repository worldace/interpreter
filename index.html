<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>interpreter</title>
</head>
<body>

<textarea id="$textarea" style="width:650px;height:500px;font-size:16px;">
let a = (10 + 5) + 5 * 7
let b = fn(n){ return n + 1 }
let c = b(a)
let d = [{"cat":"neko"}]
if(c > 100){ print("100 over") }
else{
    if(c > 50){ print(d[0]["cat"]) }
    else{ print("50 less") }
}
</textarea><br>
<button id="$button">実行 (Ctrl+Enter)</button><br>
<output id="$output"></output>


<script type="module">
import { Lexer } from './lexer.js'
import { Parser } from './parser.js'
import { Eval } from './eval.js'


function interpreter(code){
    const lexer   = new Lexer(code)
    const parser  = new Parser(lexer)
    const program = parser.parse()

    console.dir(Lexer.dump(code))
    console.dir(program)

    return Eval(program)
}


$button.onclick = function(event){
    interpreter($textarea.value)
}


document.onkeydown = function(event){
    if(event.code === 'Enter' && event.ctrlKey){
        event.preventDefault()
        $button.click()
    }
    else if(event.code === 'Tab'){
        event.preventDefault()
        /*
        const before = $textarea.value.substring(0, $textarea.selectionStart)
        const after  = $textarea.value.substring($textarea.selectionStart)
        $textarea.value = `${before}    ${after}`
        $textarea.setSelectionRange(before.length+4, before.length+4)
        */
    }
}
</script>


<!--
[依存関係]
lexer.js     : token.js
parser.js    : lexer.js token.js ast.js
evaluator.js : parser.js object.js functions.js


[map関数]
let map = fn(array, callback) {
    let iter = fn(array, accum) {
        if (len(array) == 0) {
            return accum;
        }
        else {
            return iter(rest(array), push(accum, callback(array[0])));
        }
    }

    iter(array, []);
}
print( map([1,2,3,4], fn(x){x*2}) );

-->



</body>
</html>