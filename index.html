<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>interpreter</title>
</head>
<body>


<!--
[依存関係]
lexer.js       : token.js
parser.js      : (lexer.js) token.js ast.js
evaluator.js   : (parser.js) (environment.js) builtins.js object.js
token.js       :
ast.js         :
environment.js :
builtins.js    : object.js
object.js      :
-->


<textarea id="$textarea" style="width:650px;height:500px;font-size:16px;">
let a = 50;
let b = fn(n){ return n + 1; }
let c = b(a);
let d = [5,6,7];
if(c > 100){ "100 over"; }
else{
    if(c > 50){ "50 over"; }
    else{ "50 less"; }
}
</textarea><br>
<button id="$button">実行 (Ctrl+Enter)</button><br>
<output id="$output"></output>



<script type="module">
import { Lexer } from './lexer.js'
import { Parser } from './parser.js'
import { Eval } from './evaluator.js'
import { Environment } from './environment.js'


function interpreter(code){
    const lexer   = new Lexer(code)
    const parser  = new Parser(lexer)
    const program = parser.parse()

    console.dir(Lexer.dump(code))
    console.dir(program)
    for(const v of parser.errors){
        console.log(`[ERROR] ${v}`)
    }

    const env = new Environment(new Map())
    return Eval(program, env)
}


$button.onclick = function(event){
    $output.textContent = interpreter($textarea.value)?.inspect()
}


document.onkeydown = function(event){
    if(event.code === 'Enter' && event.ctrlKey){
        event.preventDefault()
        $button.click()
    }
    else if(event.code === 'Tab'){
        event.preventDefault()
        //this.value = this.value.substr(0, this.selectionStart) + '    ' + this.value.substr(this.selectionStart)
        //this.dispatchEvent(new KeyboardEvent('keydown', {keyCode: 13}))
    }
}
</script>

</body>
</html>